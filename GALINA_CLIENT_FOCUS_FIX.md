# Исправление: Галина теперь дает советы клиенту, а не полиции

## Проблема
Галина давала рекомендации полиции/судье/прокурору вместо того, чтобы консультировать клиента (пострадавшего/заявителя).

**Пример неправильного поведения:**
```
Рекомендации Галины
Процессуальные действия
Провести повторное рассмотрение обращения Егорова Ю.П. и уведомить его о результатах.
Как реализовать: Назначить ответственного за рассмотрение обращения и установить сроки.
Сроки: 14 дней
```

## Решение
Обновлены промпты в `backend/services/advancedDocumentAnalysisService.js`:

### 1. Системный промпт (ANALYSIS_SYSTEM_PROMPT)
Добавлены четкие инструкции:
- "ВСЕ рекомендации давай КЛИЕНТУ (пострадавшему/заявителю), а НЕ полиции/судье/прокурору"
- "Клиент - это тот, кто обратился за помощью и получил этот документ"

### 2. Пользовательский промпт (ANALYSIS_USER_PROMPT)
Усилены инструкции:
- "ВСЕ рекомендации давай КЛИЕНТУ (пострадавшему/заявителю), который получил этот документ"
- "НЕ давай советы полиции, судье или прокурору - только клиенту"
- "Риски: Найди РЕАЛЬНЫЕ правовые и процессуальные риски для КЛИЕНТА"
- "Рекомендации: Предложи конкретные действия ДЛЯ КЛИЕНТА"

### 3. Формат ответа
Обновлены описания полей:
- `description`: "описание риска для клиента"
- `mitigation`: "способ устранения риска клиентом"
- `solution`: "что может сделать клиент"
- `description`: "что должен сделать КЛИЕНТ"
- `implementation`: "план действий для КЛИЕНТА"
- `overallAssessment`: "общая оценка ситуации клиента"
- `criticalPoints`: ["ключевые моменты для клиента"]
- `nextSteps`: ["следующие шаги для клиента"]

## Результат
Теперь Галина правильно консультирует клиента:

**Пример правильного поведения:**
```json
{
  "recommendations": [
    {
      "priority": "high",
      "category": "жалоба",
      "title": "Подать жалобу на отказ в возбуждении уголовного дела",
      "description": "Клиент должен подать жалобу на постановление об отказе в возбуждении уголовного дела.",
      "implementation": "Подготовить и подать жалобу в вышестоящий орган, указав на недостатки в постановлении.",
      "owner": "Клиент",
      "deadline": "в течение 10 дней с момента получения постановления",
      "requiresDocument": true
    }
  ]
}
```

## Тестирование
✅ Протестировано на примере постановления об отказе в возбуждении уголовного дела
✅ Галина теперь дает советы клиенту о подаче жалобы
✅ Batch analysis также использует исправленные промпты
✅ Все рекомендации направлены на действия клиента

## Файлы изменены
- `backend/services/advancedDocumentAnalysisService.js` - обновлены промпты

## Дата исправления
21 октября 2025 года

## Статус
✅ ИСПРАВЛЕНО И ПРОТЕСТИРОВАНО




